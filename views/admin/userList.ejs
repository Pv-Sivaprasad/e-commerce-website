<%- include('../layouts/adminHeader') %>

<section class="content-main">
    <div class="content-header">
        <div>
            <h2 class="content-title card-title">Customers List</h2>
        </div>
    </div>
    <div class="card mb-4">
        <div class="card-body">
            <table class="table "id='reloadDiv'>
                <thead>
                    <tr>
                        <th>S No</th>
                        <th scope="col">Name</th>
                        <th scope="col">Email</th>
                        <th scope="col">Mobile</th>
                        <th scope="col">Status</th>
                        <th scope="col">Action</th>
                    </tr>
                </thead>
                <tbody>
                    <% if (users.length > 0) { %>
                        <% users.forEach((user, i) => { %>
                            <tr>
                                <td><%= i + 1 %></td>
                                <td><%= users[i].name %></td>
                                <td><b><%= user.email %></b></td>
                                <td><%= user.mobile %></td>
                                <td>
                                    <span class="badge rounded-pill alert-warning">
                                        <% if (user.is_verified === 1) { %>
                                            verified
                                        <% } else { %>
                                            not verified
                                        <% } %>
                                    </span>
                                </td>
                                <td>
                                    <% if (user.is_blocked === 1) { %>
                                        <a style="color: red;" class="block-unblock" data-user-id="<%= user._id %>" data-action="block">Block</a>
                                    <% } else { %>
                                        <a style="color: green;" class="block-unblock" data-user-id="<%= user._id %>" data-action="unblock">Unblock</a>
                                    <% } %>
                                </td>
                            </tr>
                        <% }) %>
                    <% } %>
                </tbody>
            </table>
        </div>
    </div>
    <div class="pagination-area mt-30 mb-50">
        <nav aria-label="Page navigation example">
            <ul class="pagination justify-content-start">
                <li class="page-item active"><a class="page-link" href="#">01</a></li>
                <li class="page-item"><a class="page-link" href="#">02</a></li>
                <li class="page-item"><a class="page-link" href="#">03</a></li>
                <li class="page-item"><a class="page-link dot" href="#">...</a></li>
                <li class="page-item"><a class="page-link" href="#">16</a></li>
                <li class="page-item">
                    <a class="page-link" href="#"><i class="material-icons md-chevron_right"></i></a>
                </li>
            </ul>
        </nav>
    </div>
</section>
</main>

<!-- Modal -->
<div class="modal fade" id="staticBackdrop" data-bs-backdrop="static" data-bs-keyboard="false" tabindex="-1" aria-labelledby="staticBackdropLabel" aria-hidden="true">
    <div class="modal-dialog">
        <div class="modal-content">
            <div class="modal-header">
                <h1 class="modal-title fs-5" id="staticBackdropLabel">Confirm Block/Unblock</h1>
                <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
            </div>
            <div class="modal-body" id="modalBody">
                Are you sure you want to block/unblock this user?
            </div>
            <div class="modal-footer">
                <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Cancel</button>
                <button type="button" class="btn btn-primary" id="modalAction">Confirm</button>
            </div>
        </div>
    </div>
</div>
<script>
    function blockUnblock(user_id) {
        fetch('/admin/blockAndUnblock', {
            method: 'PATCH',
            headers: {
                "content-type": "application/json;charset=utf-8",
            },
            body: JSON.stringify({
                user_id
            })
        })
        .then(res => res.json())  
        .then(data => {
            if (data.res) {
                // Update the specific row in the table
                const statusBadge = $(`tr[data-user-id='${user_id}'] .status-badge`);
                const actionLink = $(`tr[data-user-id='${user_id}'] .block-unblock`);

                // Update status badge
                statusBadge.text(data.is_blocked ? 'not verified' : 'verified');
                statusBadge.toggleClass('alert-warning alert-success');

                // Update action link
                const actionText = data.is_blocked ? 'Unblock' : 'Block';
                actionLink.text(actionText);
                actionLink.css('color', data.is_blocked ? 'green' : 'red');
            }
        })
        .catch(err => {
            console.log(err);
        })   
    }
</script>

<%- include('../layouts/adminFooter') %>


