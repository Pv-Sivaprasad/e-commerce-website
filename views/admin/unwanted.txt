<%- include('../layouts/adminHeader') %>

<div class="d-flex justify-content-end pe-4 pt-2">
    <div class="dropdown">
        <button class="btn btn-info dropdown-toggle" type="button" id="salesReportDropdown"
            data-bs-toggle="dropdown" aria-haspopup="true" aria-expanded="false">
            Sales Report
        </button>
        <ul class="dropdown-menu" aria-labelledby="salesReportDropdown">
            <li><a class="dropdown-item" href="/admin/salesDaily"><i
                        class="fas fa-calendar-day me-2"></i>Daily</a>
            </li>
            <li><a class="dropdown-item" href="/admin/salesWeekly"><i
                        class="fas fa-calendar-week me-2"></i>Weekly</a>
            </li>
            <li><a class="dropdown-item" href="/admin/salesMonthly"><i
                        class="fas fa-calendar-alt me-2"></i>Monthly</a></li>
            <li><a class="dropdown-item" href="/admin/salesYearly"><i
                        class="fas fa-calendar me-2"></i>Yearly</a></li>
        </ul>
    </div>
</div>
<div class="card-body">
    <div class="table-responsive">
        <table class="table table-hover">
            <thead>
                <tr>
                    <th style="width: 50px;">ID</th>
                    <th>Date</th>
                    <th>Total Orders</th>
                    <th>Total Amount</th>
                </tr>
            </thead>
            <tbody>
                <% report.forEach((order, index) => { %>
                    <tr>
                        <td><%= index + 1 %></td>
                        <td><%= order._id %></td>
                        <td><%= order.totalOrders %></td>
                        <td>₹<%= order.totalAmount.toFixed(2) %></td>
                    </tr>
                <% }); %>
                <tr> 
                    <td colspan="2"><strong>Total:</strong></td> 
                    <td><%= totalOrders %></td> 
                    <td>₹<%= totalAmount.toFixed(2) %></td> 
                </tr>
            </tbody>   
            </table>
    </div>
</div>

<!-- <div class="text-center mb-4">
    <a href="/admin/pdf" class="btn btn-success mr-2">Download as PDF</a>
    <a href="/admin/excel" class="btn btn-success">Download as Excel</a>
</div> -->
<div class="text-center mb-4">
    <a id="downloadPDFButton" href="#" class="btn btn-success mr-2">Download as PDF</a>
    <a id="downloadExcelButton" href="#" class="btn btn-success">Download as Excel</a>
</div>

<br><br>




<br><br><br>
<%- include('../layouts/adminFooter') %>

<script>
    // JavaScript to handle downloading PDF and Excel
document.getElementById("downloadPDFButton").addEventListener("click", function() {
    downloadReport('pdf');
});

document.getElementById("downloadExcelButton").addEventListener("click", function() {
    downloadReport('excel');
});

function downloadReport(type) {
    // Send table data to backend
    const tableData = collectTableData();
    
    // Send the data to the backend via fetch or other AJAX method
    fetch('/admin/downloadReport', {
        method: 'POST',
        headers: {
            'Content-Type': 'application/json'
        },
        body: JSON.stringify({ type: type, data: tableData })
    })
    .then(response => {
        // Handle response here if needed
        // For example, show a success message or redirect the user
    })
    .catch(error => {
        console.error('Error:', error);
    });
}

function collectTableData() {
    const rows = document.querySelectorAll("table tbody tr");
    const data = [];

    rows.forEach(row => {
        const rowData = {
            id: row.cells[0].innerText,
            date: row.cells[1].innerText,
            totalOrders: row.cells[2].innerText,
            totalAmount: row.cells[3].innerText
        };
        data.push(rowData);
    });

    return data;
}

</script>







<%- include('../layouts/adminHeader') %>
<script src="https://rawgit.com/eKoopmans/html2pdf/master/dist/html2pdf.bundle.js"></script>

<div class="d-flex justify-content-end pe-4 pt-2">
    <div class="dropdown">
        <button class="btn btn-info dropdown-toggle" type="button" id="salesReportDropdown"
            data-bs-toggle="dropdown" aria-haspopup="true" aria-expanded="false">
            Sales Report
        </button>
        <ul class="dropdown-menu" aria-labelledby="salesReportDropdown">
            <li><a class="dropdown-item" href="/admin/salesDaily"><i
                        class="fas fa-calendar-day me-2"></i>Daily</a>
            </li>
            <li><a class="dropdown-item" href="/admin/salesWeekly"><i
                        class="fas fa-calendar-week me-2"></i>Weekly</a>
            </li>
            <li><a class="dropdown-item" href="/admin/salesMonthly"><i
                        class="fas fa-calendar-alt me-2"></i>Monthly</a></li>
            <li><a class="dropdown-item" href="/admin/salesYearly"><i
                        class="fas fa-calendar me-2"></i>Yearly</a></li>
        </ul>
    </div>
</div>
<div class="card-body">
    <div class="table-responsive">
        <table class="table table-hover">
            <thead>
                <tr>
                    <th style="width: 50px;">ID</th>
                    <th>Date</th>
                    <th>Total Orders</th>
                    <th>Total Amount</th>
                </tr>
            </thead>
            <tbody>
                <% report.forEach((order, index) => { %>
                    <tr>
                        <td><%= index + 1 %></td>
                        <td><%= order._id %></td>
                        <td><%= order.totalOrders %></td>
                        <td>₹<%= order.totalAmount.toFixed(2) %></td>
                    </tr>
                <% }); %>
                <tr> 
                    <td colspan="2"><strong>Total:</strong></td> 
                    <td><%= totalOrders %></td> 
                    <td>₹<%= totalAmount.toFixed(2) %></td> 
                </tr>
            </tbody>   
            </table>
    </div>
</div>
<div class="invoice-company text-inverse f-w-600">
    <span class="pull-right hidden-print">
        <a href="javascript:;" class="btn btn-sm btn-white m-b-10 p-l-5" id="exportPdf" ><i
                class="fa fa-file t-plus-1 text-danger fa-fw fa-lg"></i> Export as PDF</a>
        <a href="javascript:;" onclick="window.print()" class="btn btn-sm btn-white m-b-10 p-l-5"><i
                class="fa fa-print t-plus-1 fa-fw fa-lg"></i> Print</a>
    </span>
</div>

<br><br><br>
<%- include('../layouts/adminFooter') %>
<script>
    $(document).ready(function () {
        $('#exportPdf').on('click', function () {            
            var options = {
                margin: 10,
                filename: 'sales.pdf',
                image: { type: 'jpeg', quality: 0.98 },
                html2canvas: { scale: 2 },
                jsPDF: { unit: 'mm', format: 'a4', orientation: 'portrait' }
            };            
            var element = document.body; // Changed the selector to 'document.body' to capture the entire page.
            html2pdf().from(element).set(options).save(); // Modified to capture the entire page and simplified the method chain.
        });
    });
</script>
